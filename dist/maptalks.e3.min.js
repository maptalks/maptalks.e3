/*!
 * maptalks.e3 v0.4.5
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@^0.25.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks"),require("echarts")):"function"==typeof define&&define.amd?define(["exports","maptalks","echarts"],e):e(t.maptalks=t.maptalks||{},t.maptalks,t.echarts)}(this,function(t,e,n){"use strict";function i(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],r=Object.getOwnPropertyDescriptor(e,o);r&&r.configurable&&void 0===t[o]&&Object.defineProperty(t,o,r)}return t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):i(t,e))}var a={container:"front",renderer:"dom",hideOnZooming:!1,hideOnMoving:!1,hideOnRotating:!1},p=function(t){function e(n,i,s){o(this,e);var a=r(this,t.call(this,n,s));return a._ecOptions=i,a}return s(e,t),e.prototype.getEChartsOption=function(){return this._ecOptions},e.prototype.setEChartsOption=function(t){return this._ecOptions=t,this._getRenderer()&&this._getRenderer()._clearAndRedraw(),this},e.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),ecOptions:this._ecOptions,options:this.config()}},e.fromJSON=function(t){return t&&"E3Layer"===t.type?new e(t.id,t.ecOptions,t.options):null},e}(e.Layer);p.mergeOptions(a),p.registerJSONType("E3Layer"),p.registerRenderer("dom",function(){function t(e){o(this,t),this.layer=e}return t.prototype.render=function(){this._container||this._createLayerContainer(),this._ec?this._isVisible()&&this._ec.resize():(this._ec=n.init(this._container),this._prepareECharts(),this._ec.setOption(this.layer._ecOptions,!1)),this.layer.fire("layerload")},t.prototype.drawOnInteracting=function(){this._isVisible()&&this._ec.resize()},t.prototype.needToRedraw=function(){var t=this.getMap(),e=t._getRenderer();return t.isInteracting()||e&&(e.isStateChanged&&e.isStateChanged()||e.isViewChanged&&e.isViewChanged())},t.prototype.getMap=function(){return this.layer.getMap()},t.prototype._isVisible=function(){return this._container&&""===this._container.style.display},t.prototype.show=function(){this._container&&(this._container.style.display="")},t.prototype.hide=function(){this._container&&(this._container.style.display="none")},t.prototype.remove=function(){this._ec.clear(),this._ec.dispose(),delete this._ec,this._removeLayerContainer()},t.prototype.clear=function(){this._ec.clear()},t.prototype.setZIndex=function(t){this._zIndex=t,this._container&&(this._container.style.zIndex=t)},t.prototype.isCanvasRender=function(){return!1},t.prototype._prepareECharts=function(){this._registered||(this._coordSystemName="maptalks"+e.Util.GUID(),n.registerCoordinateSystem(this._coordSystemName,this._getE3CoordinateSystem(this.getMap())),this._registered=!0);var t=this.layer._ecOptions.series;if(t)for(var i=t.length-1;i>=0;i--)t[i].coordinateSystem=this._coordSystemName,t[i].animation=!1},t.prototype._createLayerContainer=function(){var t=this._container=e.DomUtil.createEl("div");t.style.cssText="position:absolute;left:0px;top:0px;",this._zIndex&&(t.style.zIndex=this._zIndex),this._resetContainer(),("front"===this.layer.options.container?this.getMap()._panels.frontStatic:this.getMap()._panels.backStatic).appendChild(t)},t.prototype._removeLayerContainer=function(){this._container&&e.DomUtil.removeDomNode(this._container),delete this._levelContainers},t.prototype._resetContainer=function(){var t=this.getMap().getSize();this._container.style.width=t.width+"px",this._container.style.height=t.height+"px"},t.prototype._getE3CoordinateSystem=function(t){var i=function(t){this.map=t,this._mapOffset=[0,0]},o=this;return i.create=function(e){e.eachSeries(function(e){e.get("coordinateSystem")===o._coordSystemName&&(e.coordinateSystem=new i(t))})},i.getDimensionsInfo=function(){return["x","y"]},i.dimensions=["x","y"],e.Util.extend(i.prototype,{dimensions:["x","y"],setMapOffset:function(t){this._mapOffset=t},dataToPoint:function(t){var n=new e.Coordinate(t),i=this.map.coordinateToContainerPoint(n),o=this._mapOffset;return[i.x-o[0],i.y-o[1]]},pointToData:function(t){var e=this._mapOffset,n=this.map.containerPointToCoordinate({x:t[0]+e[0],y:t[1]+e[1]});return[n.x,n.y]},getViewRect:function(){var t=this.map.getSize();return new n.graphic.BoundingRect(0,0,t.width,t.height)},getRoamTransform:function(){return n.matrix.create()}}),i},t.prototype.getEvents=function(){return{_zoomstart:this.onZoomStart,_zoomend:this.onZoomEnd,_dragrotatestart:this.onDragRotateStart,_dragrotateend:this.onDragRotateEnd,_movestart:this.onMoveStart,_moveend:this.onMoveEnd,_resize:this._resetContainer}},t.prototype._clearAndRedraw=function(){this._container&&"none"===this._container.style.display||(this._ec.clear(),this._ec.resize(),this._prepareECharts(),this._ec.setOption(this.layer._ecOptions,!1))},t.prototype.onZoomStart=function(){this.layer.options.hideOnZooming&&this.hide()},t.prototype.onZoomEnd=function(){this.layer.options.hideOnZooming&&(this.show(),this._clearAndRedraw())},t.prototype.onDragRotateStart=function(){this.layer.options.hideOnRotating&&this.hide()},t.prototype.onDragRotateEnd=function(){this.layer.options.hideOnRotating&&(this.show(),this._clearAndRedraw())},t.prototype.onMoveStart=function(){this.layer.options.hideOnMoving&&this.hide()},t.prototype.onMoveEnd=function(){this.layer.options.hideOnMoving&&(this.show(),this._clearAndRedraw())},t}()),t.E3Layer=p,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.e3 v0.4.5, requires maptalks@^0.25.0.")});